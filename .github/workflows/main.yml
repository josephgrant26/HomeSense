name: Build LaTeX PDFs

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install TeX Live
        run: |
          sudo apt-get update && sudo apt-get install -y \
          latexmk \
          texlive \
          texlive-latex-extra \
          texlive-lang-italian

      - name: Compile all .tex files
        run: |
          shopt -s globstar
          mkdir -p site
          for texfile in verbali/**/*.tex; do
            rel_path="${texfile#verbali/}"
            dir_path=$(dirname "$rel_path")
            mkdir -p "site/$dir_path"

            # Copia immagini nella stessa cartella dove latexmk creerÃ  i PDF
            cp "verbali/$dir_path"/*.jpg "site/$dir_path/" 2>/dev/null || true
            cp "verbali/$dir_path"/*.png "site/$dir_path/" 2>/dev/null || true

            echo "Compiling $texfile..."
            latexmk -pdf -interaction=nonstopmode -f -output-directory="site/$dir_path" "$texfile" || true
          done

      - name: Upload PDFs
        uses: actions/upload-artifact@v4
        with:
          name: PDFs
          path: site/**/*.pdf
